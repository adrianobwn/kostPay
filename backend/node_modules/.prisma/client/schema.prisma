// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Users (previously Pengguna)
model Users {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String   // ADMIN, PENGHUNI
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notifikasi Notifikasi[]
  sewa       Sewa[]
  booking    Booking[]

  @@map("Users")
}

// Notifikasi (NEW)
model Notifikasi {
  id        Int      @id @default(autoincrement())
  userId    Int
  message   String   @db.Text
  status    String   // READ, UNREAD
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user Users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Notifikasi")
}

// Sewa (replaces Pemesanan)
model Sewa {
  id                 Int      @id @default(autoincrement())
  userId             Int
  idKamar            Int
  tanggalMulaiSewa   DateTime
  tanggalTenggatSewa DateTime
  status             String   // AKTIF, SELESAI
  totalBayar         Int
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user  Users @relation(fields: [userId], references: [id], onDelete: Cascade)
  kamar Kamar @relation(fields: [idKamar], references: [id])

  @@map("Sewa")
}

// Booking (NEW)
model Booking {
  id             Int       @id @default(autoincrement())
  userId         Int
  idKamar        Int
  tanggalMasuk   DateTime
  tanggalKeluar  DateTime?
  status         String    // PENDING, APPROVED, REJECTED
  ktp            String?   @db.Text
  foto           String?   @db.Text
  paymentProof   String?   @db.Text
  agreementProof String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  user     Users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  kamar    Kamar      @relation(fields: [idKamar], references: [id])
  payments Payments[]

  @@map("Booking")
}

// Payments (previously Pembayaran)
model Payments {
  id           Int      @id @default(autoincrement())
  idBooking    Int
  paymentProof String?  @db.Text
  status       String   // PENDING, VERIFIED, REJECTED
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  booking Booking @relation(fields: [idBooking], references: [id], onDelete: Cascade)

  @@map("Payments")
}

// Kamar (updated fields)
model Kamar {
  id          Int      @id @default(autoincrement())
  kodeKamar   String   @unique
  tipeKamar   Int
  harga       Int
  statusKamar String   // TERSEDIA, TERISI, MAINTENANCE
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tipe    Tipe_Kamar @relation(fields: [tipeKamar], references: [id])
  sewa    Sewa[]
  booking Booking[]

  @@map("Kamar")
}

// Tipe_Kamar (updated fields)
model Tipe_Kamar {
  id          Int      @id @default(autoincrement())
  nama        String
  fasilitas   String   @db.Text // JSON string array
  statusKamar String   // ACTIVE, INACTIVE
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  kamar Kamar[]

  @@map("Tipe_Kamar")
}
